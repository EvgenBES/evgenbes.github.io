<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="shortcut icon" href="style/images/favicon.png">
  <title>Lumos</title>
  <!-- Bootstrap core CSS -->
  <link href="style/css/bootstrap.min.css" rel="stylesheet">
  <link href="style/css/plugins.css" rel="stylesheet">
  <link href="style/css/prettify.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
  <link href="style/css/color/green.css" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Raleway:400,800,700,600,500,300' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic' rel='stylesheet' type='text/css'>
  <link href="style/type/fontello.css" rel="stylesheet">
  <link href="style/type/budicons.css" rel="stylesheet">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="style/js/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>
	
	
	


	
	
	
  <body class="full-layout">
	
	  
	  
	  
	  
	  
	  
	  <?php

// Type Notification

$forpostTp = 'NOTIFICATION_FORPOST_TP';
$octalTp = 'NOTIFICATION_OCTAL_TP';
$forpostClose = 'NOTIFICATION_FORPOST_CLOSE';
$octalClose = 'NOTIFICATION_OCTAL_CLOSE';

$time105m = 6300;

//GET FORPOST 

//The URL that we want to GET.
$url = 'http://service.neverlands.ru/info/cityhall_1.txt';

//Use file_get_contents to GET the URL in question.
$txt_file = file_get_contents($url);

$rows = explode("\n", $txt_file);
array_shift($rows);

foreach($rows as $line) {

	$result = (int) strlen(stristr($line, 'i_w28_33', true));

	if ($result > 5) {
		$data = array(
			"type" => $forpostTp
		);
		sendPushNotification($forpostClose, $data, $time120m);
	}	
}

//GET OCTAL ! 

//The URL that we want to GET.
$urlOct = 'http://service.neverlands.ru/info/cityhall_2.txt';

//Use file_get_contents to GET the URL in question.
$txt_fileOct = file_get_contents($urlOct);

$rowsOct = explode("\n", $txt_fileOct);
array_shift($rowsOct);

foreach($rowsOct as $line) {

	$result = (int) strlen(stristr($line, 'i_w28_33', true));

	if ($result > 5) {
		$data = array(
			"type" => $octalTp
		);
		sendPushNotification($forpostClose, $data, $time120m);
	}	
}


function sendPushNotification($to = '', $data = array(), $time = 1) {
	$apiKey = 'AAAAypckyuI:APA91bG1lpkgriF80Qkam9fwOHPWj5rHY0zbj-XYfKUs0jjyy4qkSzm_CfSOTZu2hmtzDL-YOAniN0ZJD8ARTdbt0URLg4hIZNrEF3xQK_j3jNx4hrM87Kl-CjsE0D0SlxHnk7WXaLqL';

	$url = 'https://fcm.googleapis.com/fcm/send';

	$fields = [
		"to" => '/topics/'.$to,
		"data" => $data,
		'priority' => 'high',
		"time_to_live" => $time
	];

	$headers = array( 
		'Authorization: key='.$apiKey, 
		'Content-Type: application/json'
	);

	$url = 'https://fcm.googleapis.com/fcm/send';

	$ch = curl_init();
	curl_setopt( $ch, CURLOPT_URL, $url);
	curl_setopt( $ch, CURLOPT_POST, true);
	curl_setopt( $ch, CURLOPT_HTTPHEADER, $headers);
	curl_setopt( $ch, CURLOPT_RETURNTRANSFER, true);
	curl_setopt( $ch, CURLOPT_SSL_VERIFYPEER, false);
	curl_setopt( $ch, CURLOPT_POSTFIELDS, json_encode($fields));
	$result = curl_exec($ch);
	curl_close($ch);
	return json_decode($result, true);
}

?> 
	  
	  
	  
	  
	  
	  
  
<!-- /.body-wrapper --> 
<script src="style/js/jquery.min.js"></script> 
<script src="style/js/bootstrap.min.js"></script> 
<script src="style/js/jquery.themepunch.tools.min.js"></script> 
<script src="style/js/classie.js"></script> 
<script src="style/js/plugins.js"></script> 
<script src="style/js/scripts.js"></script>  
<script>
	$.backstretch(["style/images/art/bg1.jpg"]);
</script>
</body>
</html>
